<!-- Seção de Custos de Equipamentos -->
<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0 section-title">Custos de Equipamentos</h5>
    </div>
    <div class="card-body">
        {% if tem_dados_equipamentos %}
            <!-- Gráficos Analíticos -->
            <div class="row mb-4">
                <!-- Gráfico de Rosca -->
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-light text-center">
                            <h6 class="mb-0 text-dark">Distribuição por Categoria</h6>
                        </div>
                        <div class="card-body p-3">
                            <div style="height: 300px;">
                                <canvas id="graficoRoscaEquipamentos"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gráfico de Barras Empilhadas -->
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-light text-center">
                            <h6 class="mb-0 text-dark">Custo Mensal por Equipe</h6>
                        </div>
                        <div class="card-body p-3">
                            <div style="height: 300px;">
                                <canvas id="graficoBarrasEmpilhadasEquipamentos"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Tabela Detalhada -->
            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle text-center table-compact">
                    <thead class="table-light">
                        <tr>
                            <th>Contrato</th>
                            <th>Equipe</th>
                            <th>Regional</th>
                            <th>Escopo</th>
                            <th>Qtd Equipes</th>
                            <th><i class="fas fa-hard-hat"></i> EPI</th>
                            <th><i class="fas fa-shield-alt"></i> EPC</th>
                            <th><i class="fas fa-wrench"></i> Ferramentas</th>
                            <th><i class="fas fa-laptop"></i> Equip. TI</th>
                            <th><i class="fas fa-wifi"></i> Desp. TI</th>
                            <th><i class="fas fa-boxes"></i> Materiais</th>
                            <th><i class="fas fa-ellipsis-h"></i> Diversas</th>
                            <th>Mensal por Equipe</th>
                            <th>Total Mensal</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for custo_equipamento in custos_equipamentos %}
                        <tr>
                            <td><span class="badge bg-light text-dark">{{ custo_equipamento.contrato.contrato }}</span></td>
                            <td><strong>{{ custo_equipamento.equipe.nome }}</strong></td>
                            <td>{{ custo_equipamento.regional.nome }}</td>
                            <td>{{ custo_equipamento.escopo.nome }}</td>
                            <td><span class="badge bg-light text-dark">{{ custo_equipamento.quantidade_equipes }}</span></td>
                            <td>R$ {{ custo_equipamento.custos_categorias.EPI|floatformat:2 }}</td>
                            <td>R$ {{ custo_equipamento.custos_categorias.EPC|floatformat:2 }}</td>
                            <td>R$ {{ custo_equipamento.custos_categorias.FERRAMENTAS|floatformat:2 }}</td>
                            <td>R$ {{ custo_equipamento.custos_categorias.EQUIPAMENTOS_TI|floatformat:2 }}</td>
                            <td>R$ {{ custo_equipamento.custos_categorias.DESPESAS_TI|floatformat:2 }}</td>
                            <td>R$ {{ custo_equipamento.custos_categorias.MATERIAIS_CONSUMO|floatformat:2 }}</td>
                            <td>R$ {{ custo_equipamento.custos_categorias.DESPESAS_DIVERSAS|floatformat:2 }}</td>
                            <td><strong>R$ {{ custo_equipamento.custo_mensal_por_equipe|floatformat:2 }}</strong></td>
                            <td><strong>R$ {{ custo_equipamento.custo_total_mensal|floatformat:2 }}</strong></td>
                        </tr>
                        {% endfor %}
                        <!-- Linha de Somatório -->
                        <tr class="table-light">
                            <td colspan="5">TOTAL GERAL</td>
                            <td><strong>R$ {{ totais_equipamentos_categoria.EPI|floatformat:2 }}</strong></td>
                            <td><strong>R$ {{ totais_equipamentos_categoria.EPC|floatformat:2 }}</strong></td>
                            <td><strong>R$ {{ totais_equipamentos_categoria.FERRAMENTAS|floatformat:2 }}</strong></td>
                            <td><strong>R$ {{ totais_equipamentos_categoria.EQUIPAMENTOS_TI|floatformat:2 }}</strong></td>
                            <td><strong>R$ {{ totais_equipamentos_categoria.DESPESAS_TI|floatformat:2 }}</strong></td>
                            <td><strong>R$ {{ totais_equipamentos_categoria.MATERIAIS_CONSUMO|floatformat:2 }}</strong></td>
                            <td><strong>R$ {{ totais_equipamentos_categoria.DESPESAS_DIVERSAS|floatformat:2 }}</strong></td>
                            <td><strong>-</strong></td>
                            <td><strong>R$ {{ custo_total_equipamentos|floatformat:2 }}</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        {% else %}
            <!-- Estado Vazio -->
            <div class="text-center py-5">
                <i class="fas fa-tools text-muted" style="font-size: 4rem;"></i>
                <h4 class="mt-3 text-muted">Nenhum equipamento cadastrado</h4>
                <p class="text-muted mb-4">Para visualizar os custos de equipamentos, é necessário:</p>
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <ol class="text-start mb-4">
                            <li>Cadastrar <strong>equipamentos</strong> nas categorias (EPI, EPC, Ferramentas, etc.)</li>
                            <li>Vincular os <strong>equipamentos às equipes</strong> com quantidades específicas</li>
                            <li>Ter <strong>composições de equipe</strong> configuradas</li>
                        </ol>
                    </div>
                </div>
                <a href="{% url 'menu_cadastro_estrutura' %}" class="btn btn-warning">
                    <i class="fas fa-plus"></i> Cadastrar Equipamentos
                </a>
            </div>
        {% endif %}
    </div>
</div>

<!-- Incluir JavaScript dos gráficos -->
{% include 'dashboard/js/_equipamentos_charts.html' %}