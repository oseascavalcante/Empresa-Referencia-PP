<!-- Seção de Custos da Mão de Obra -->
<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0 section-title">Custos da Mão de Obra</h5>
    </div>
    <div class="card-body">
        {% if custos_funcoes %}
            <!-- Gráficos Analíticos -->
            <div class="row mb-4">
                <!-- Gráfico de Rosca -->
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-light text-center">
                            <h6 class="mb-0 text-dark">Distribuição por Categoria</h6>
                        </div>
                        <div class="card-body p-3">
                            <div style="height: 300px;">
                                <canvas id="graficoRoscaMaoObra"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gráfico de Barras Empilhadas -->
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-light text-center">
                            <h6 class="mb-0 text-dark">Custo por Equipe</h6>
                        </div>
                        <div class="card-body p-3">
                            <div style="height: 300px;">
                                <canvas id="graficoBarrasEmpilhadasMaoObra"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabela Detalhada -->
            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle text-center table-compact">
                    <thead class="table-light">
                        <tr>
                            <th>Contrato</th>
                            <th>Regional</th>
                            <th>Escopo</th>
                            <th>Equipe</th>
                            <th>Função</th>
                            <th>Qtd. por Equipe</th>
                            <th>Qtd. Total Funcionários</th>
                            <th>Salário Base</th>
                            <th>Benefícios</th>
                            <th>Encargos Sociais</th>
                            <th>Periculosidade</th>
                            <th>HE 50%</th>
                            <th>HE 100%</th>
                            <th>Prontidão</th>
                            <th>Sobreaviso</th>
                            <th>Adicional Noturno</th>
                            <th>Outros Custos</th>
                            <th>Custo Total por Funcionário</th>
                            <th>Custo Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for custo in custos_funcoes %}
                        <tr>
                            <td><span class="badge bg-light text-dark">{{ custo.contrato.contrato }}</span></td>
                            <td>{{ custo.composicao.regional.nome }}</td>
                            <td>{{ custo.composicao.escopo.nome }}</td>
                            <td><strong>{{ custo.composicao.equipe.nome }}</strong></td>
                            <td><em>{{ custo.funcao.nome }}</em></td>
                            <td>{{ custo.quantidade_funcionarios }}</td>
                            <td><strong>{{ custo.quantidade_total_funcionarios }}</strong></td>
                            <td>R$ {{ custo.salario_base|floatformat:2 }}</td>
                            <td>R$ {{ custo.beneficios|floatformat:2 }}</td>
                            <td>R$ {{ custo.valor_total_encargos|floatformat:2 }}</td>
                            <td>R$ {{ custo.adicional_periculosidade|floatformat:2 }}</td>
                            <td>R$ {{ custo.valor_horas_extras_50|floatformat:2 }}</td>
                            <td>R$ {{ custo.valor_horas_extras_100|floatformat:2 }}</td>
                            <td>R$ {{ custo.valor_prontidao|floatformat:2 }}</td>
                            <td>R$ {{ custo.valor_sobreaviso|floatformat:2 }}</td>
                            <td>R$ {{ custo.valor_adicional_noturno|floatformat:2 }}</td>
                            <td>R$ {{ custo.outros_custos|floatformat:2 }}</td>
                            <td><strong>R$ {{ custo.custo_por_funcionario|floatformat:2 }}</strong></td>
                            <td><strong>R$ {{ custo.custo_total|floatformat:2 }}</strong></td>
                        </tr>
                        {% endfor %}
                        <!-- Linha de Somatório -->
                        <tr class="table-light">
                            <td colspan="7">TOTAL GERAL</td>
                            <td><strong>R$ {{ totais_individuais_mao_obra.total_salario|floatformat:2 }}</strong></td>
                            <td><strong>R$ {{ totais_individuais_mao_obra.total_beneficios|floatformat:2 }}</strong></td>
                            <td><strong>R$ {{ totais_individuais_mao_obra.total_encargos|floatformat:2 }}</strong></td>
                            <td><strong>R$ {{ totais_individuais_mao_obra.total_periculosidade|floatformat:2 }}</strong></td>
                            <td><strong>R$ {{ totais_individuais_mao_obra.total_he50|floatformat:2 }}</strong></td>
                            <td><strong>R$ {{ totais_individuais_mao_obra.total_he100|floatformat:2 }}</strong></td>
                            <td><strong>R$ {{ totais_individuais_mao_obra.total_prontidao|floatformat:2 }}</strong></td>
                            <td><strong>R$ {{ totais_individuais_mao_obra.total_sobreaviso|floatformat:2 }}</strong></td>
                            <td><strong>R$ {{ totais_individuais_mao_obra.total_adicional|floatformat:2 }}</strong></td>
                            <td><strong>R$ {{ totais_individuais_mao_obra.total_outros|floatformat:2 }}</strong></td>
                            <td><strong>-</strong></td>
                            <td><strong>R$ {{ totais_individuais_mao_obra.total_geral|floatformat:2 }}</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        {% else %}
            <!-- Estado Vazio -->
            <div class="text-center py-5">
                <i class="fas fa-users text-muted" style="font-size: 4rem;"></i>
                <h4 class="mt-3 text-muted">Nenhum custo de mão de obra encontrado</h4>
                <p class="text-muted mb-4">Para visualizar os custos de mão de obra, é necessário:</p>
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <ol class="text-start mb-4">
                            <li>Cadastrar <strong>regionais</strong> no contrato</li>
                            <li>Criar <strong>equipes</strong> e <strong>funções</strong></li>
                            <li>Definir <strong>escopos de atividade</strong></li>
                            <li>Configurar <strong>composições de equipe</strong> (regional + escopo + equipe)</li>
                            <li>Adicionar <strong>funções às composições</strong> com quantidade de funcionários</li>
                        </ol>
                    </div>
                </div>
                <a href="{% url 'menu_cadastro_estrutura' %}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Configurar Estrutura
                </a>
            </div>
        {% endif %}
    </div>
</div>